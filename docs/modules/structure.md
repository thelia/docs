---
title: Module Structure
sidebar_position: 2
---

# Module Structure

This page details every component of a Thelia 3 module.

## Directory Layout

```
local/modules/MyProject/
├── MyProject.php              # Main module class
├── composer.json              # Package definition
├── Config/
│   ├── module.xml             # Module metadata
│   ├── config.xml             # Service definitions
│   ├── routing.xml            # Route definitions
│   └── schema.xml             # Database schema
├── Api/
│   ├── Resource/              # API Platform resources
│   │   └── MyResource.php
│   └── Addon/                 # Resource addons
│       └── ProductMyAddon.php
├── Controller/
│   ├── Front/
│   │   └── MyFrontController.php
│   └── Admin/
│       └── MyAdminController.php
├── EventListeners/
│   └── OrderEventListener.php
├── Service/
│   └── MyService.php
├── LiveComponent/
│   └── MyComponent.php
├── Hook/
│   └── BackHook.php
├── Loop/
│   └── MyLoop.php
├── Form/
│   └── ConfigurationForm.php
├── Command/
│   └── MyCommand.php
├── Model/
│   ├── MyProjectQuery.php     # Generated by Propel
│   └── MyProject.php          # Generated by Propel
├── templates/
│   ├── frontOffice/
│   │   └── default/
│   │       └── my-template.html.twig
│   └── backOffice/
│       └── default/
│           └── my-template.html
└── I18n/
    ├── en_US.php
    └── fr_FR.php
```

## Required Files

### MyProject.php (Main Class)

The entry point for your module:

```php
<?php

declare(strict_types=1);

namespace MyProject;

use Thelia\Module\BaseModule;

final class MyProject extends BaseModule
{
    /** Translation domain for intl functions */
    public const DOMAIN_NAME = 'myproject';

    /** Module code (used in various places) */
    public const MODULE_CODE = 'MyProject';
}
```

The main class **must**:
- Have the same name as the module directory
- Extend `Thelia\Module\BaseModule` (or `AbstractDeliveryModule` / `AbstractPaymentModule`)
- Be in a namespace matching the module name

### Config/module.xml

Module metadata for the back-office and dependency management:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<module xmlns="http://thelia.net/schema/dic/module"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://thelia.net/schema/dic/module http://thelia.net/schema/dic/module/module-2_1.xsd">

    <!-- Fully qualified class name -->
    <fullnamespace>MyProject\MyProject</fullnamespace>

    <!-- Descriptive info (multiple locales supported) -->
    <descriptive locale="en_US">
        <title>My Project Module</title>
        <subtitle>Extends Thelia with custom features</subtitle>
        <description>Full description of what this module does.</description>
        <postscriptum>Additional notes or requirements.</postscriptum>
    </descriptive>

    <!-- Languages for admin interface -->
    <languages>
        <language>en_US</language>
        <language>fr_FR</language>
    </languages>

    <!-- Semantic versioning -->
    <version>1.0.0</version>

    <!-- Author information -->
    <author>
        <name>Your Name</name>
        <email>your@email.com</email>
        <company>Your Company</company>
        <website>https://example.com</website>
    </author>

    <!-- Module type (classic, delivery, payment) -->
    <type>classic</type>

    <!-- Minimum Thelia version required -->
    <thelia>2.5.0</thelia>

    <!-- Stability: alpha, beta, rc, prod, stable -->
    <stability>stable</stability>

    <!-- Required modules -->
    <required>
        <module>AnotherModule</module>
    </required>

    <!-- Documentation URL -->
    <documentation>https://example.com/docs</documentation>

    <!-- Logo for back-office (relative to module root) -->
    <logo>logo.png</logo>
</module>
```

### Config/config.xml

Service container configuration. With autowiring, this file is often minimal:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<config xmlns="http://thelia.net/schema/dic/config"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://thelia.net/schema/dic/config http://thelia.net/schema/dic/config/thelia-config.xsd">

    <!-- Hooks (back-office only) -->
    <hooks>
        <hook id="myproject.hook.back" class="MyProject\Hook\BackHook">
            <tag name="hook.event_listener"
                 event="main.top-menu-tools"
                 type="back"
                 method="onMainTopMenuTools"/>
        </hook>
    </hooks>

    <!-- Loops (back-office only) -->
    <loops>
        <loop name="my_loop" class="MyProject\Loop\MyLoop"/>
    </loops>

    <!-- Forms -->
    <forms>
        <form name="myproject.configuration" class="MyProject\Form\ConfigurationForm"/>
    </forms>

    <!-- Console commands -->
    <commands>
        <command class="MyProject\Command\MyCommand"/>
    </commands>

    <!-- Services (if not using autowiring) -->
    <services>
        <service id="myproject.my_service" class="MyProject\Service\MyService">
            <argument type="service" id="thelia.securityContext"/>
        </service>
    </services>

    <!-- Event listeners -->
    <event_listeners>
        <event_listener class="MyProject\EventListeners\OrderEventListener">
            <tag name="kernel.event_subscriber"/>
        </event_listener>
    </event_listeners>
</config>
```

## Optional Configuration Files

### Config/routing.xml

Define routes for your controllers:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<routes xmlns="http://symfony.com/schema/routing"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://symfony.com/schema/routing
        http://symfony.com/schema/routing/routing-1.0.xsd">

    <!-- Admin routes -->
    <route id="myproject.admin.config" path="/admin/module/MyProject">
        <default key="_controller">MyProject\Controller\Admin\ConfigController::indexAction</default>
    </route>

    <!-- Front routes -->
    <route id="myproject.front.page" path="/my-feature/{id}">
        <default key="_controller">MyProject\Controller\Front\PageController::showAction</default>
        <requirement key="id">\d+</requirement>
    </route>
</routes>
```

:::tip Attribute Routing
You can also define routes directly in controllers using PHP attributes:

```php
use Symfony\Component\Routing\Annotation\Route;

#[Route('/my-feature/{id}', name: 'myproject.front.page')]
public function showAction(int $id): Response
{
    // ...
}
```
:::

### Config/schema.xml

Propel database schema for custom tables:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<database defaultIdMethod="native" name="thelia"
          namespace="MyProject\Model">

    <table name="my_project_data" namespace="MyProject\Model">
        <column name="id" primaryKey="true" required="true" type="INTEGER" autoIncrement="true"/>
        <column name="product_id" type="INTEGER"/>
        <column name="custom_field" type="VARCHAR" size="255"/>
        <column name="is_active" type="BOOLEAN" default="1"/>
        <column name="created_at" type="TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP"/>

        <foreign-key foreignTable="product" onDelete="CASCADE">
            <reference local="product_id" foreign="id"/>
        </foreign-key>

        <behavior name="timestampable"/>
    </table>

    <!-- Table with i18n support -->
    <table name="my_project_content" namespace="MyProject\Model">
        <column name="id" primaryKey="true" required="true" type="INTEGER" autoIncrement="true"/>
        <column name="visible" type="BOOLEAN" default="1"/>

        <behavior name="timestampable"/>
        <behavior name="i18n">
            <parameter name="i18n_columns" value="title, description"/>
        </behavior>
    </table>
</database>
```

After modifying the schema, regenerate models:

```bash
php Thelia module:generate:model MyProject
php Thelia module:generate:sql MyProject
```

### composer.json

For distributing your module:

```json
{
    "name": "your-vendor/my-project",
    "description": "Custom Thelia module",
    "type": "thelia-module",
    "license": "MIT",
    "require": {
        "thelia/installer": "~1.1"
    },
    "extra": {
        "installer-name": "MyProject"
    },
    "autoload": {
        "psr-4": {
            "MyProject\\": ""
        }
    }
}
```

## API Components

### Api/Resource/

API Platform resources expose your data via REST endpoints:

```php
<?php

declare(strict_types=1);

namespace MyProject\Api\Resource;

use ApiPlatform\Metadata\ApiResource;
use ApiPlatform\Metadata\Get;
use ApiPlatform\Metadata\GetCollection;
use Thelia\Api\Resource\PropelResourceInterface;
use Thelia\Api\Resource\PropelResourceTrait;

#[ApiResource(
    operations: [
        new GetCollection(uriTemplate: '/front/my-resources'),
        new Get(uriTemplate: '/front/my-resources/{id}'),
    ],
)]
class MyResource implements PropelResourceInterface
{
    use PropelResourceTrait;

    public ?int $id = null;
    public string $name;

    public static function getPropelRelatedTableMap(): ?TableMap
    {
        return new \MyProject\Model\Map\MyProjectDataTableMap();
    }
}
```

See [API Resources](./api-resources) for complete documentation.

### Api/Addon/

Resource addons enrich existing resources:

```php
<?php

declare(strict_types=1);

namespace MyProject\Api\Addon;

use Thelia\Api\Resource\Product;
use Thelia\Api\Resource\ResourceAddonInterface;
use Thelia\Api\Resource\ResourceAddonTrait;

class ProductCustomField implements ResourceAddonInterface
{
    use ResourceAddonTrait;

    #[Groups([Product::GROUP_ADMIN_READ, Product::GROUP_FRONT_READ])]
    public ?string $customField = null;

    // Implementation...
}
```

See [API Addons](./api-addons) for complete documentation.

## Front-Office Components

### LiveComponent/

Symfony UX LiveComponents for interactive interfaces:

```php
<?php

declare(strict_types=1);

namespace MyProject\LiveComponent;

use Symfony\UX\LiveComponent\Attribute\AsLiveComponent;
use Symfony\UX\LiveComponent\Attribute\LiveProp;
use Symfony\UX\LiveComponent\DefaultActionTrait;

#[AsLiveComponent(
    name: 'MyProject:MyComponent',
    template: '@MyProject/live-component/my-component.html.twig'
)]
final class MyComponent
{
    use DefaultActionTrait;

    #[LiveProp(writable: true)]
    public string $query = '';

    // Component logic...
}
```

See [LiveComponents](./live-components) for complete documentation.

## Back-Office Components

### Hook/

Inject content into back-office templates:

```php
<?php

declare(strict_types=1);

namespace MyProject\Hook;

use Thelia\Core\Event\Hook\HookRenderBlockEvent;
use Thelia\Core\Hook\BaseHook;

class BackHook extends BaseHook
{
    public function onMainTopMenuTools(HookRenderBlockEvent $event): void
    {
        $event->add([
            'id' => 'myproject-menu',
            'title' => $this->trans('My Module', [], 'myproject'),
            'url' => $this->getRouteUrl('myproject.admin.config'),
        ]);
    }
}
```

### Loop/

Custom loops for back-office templates:

```php
<?php

declare(strict_types=1);

namespace MyProject\Loop;

use Propel\Runtime\ActiveQuery\ModelCriteria;
use Thelia\Core\Template\Element\BaseLoop;
use Thelia\Core\Template\Element\LoopResult;
use Thelia\Core\Template\Element\LoopResultRow;
use Thelia\Core\Template\Loop\Argument\Argument;
use Thelia\Core\Template\Loop\Argument\ArgumentCollection;

class MyLoop extends BaseLoop
{
    protected function getArgDefinitions(): ArgumentCollection
    {
        return new ArgumentCollection(
            Argument::createBooleanTypeArgument('active', true),
        );
    }

    public function buildModelCriteria(): ModelCriteria
    {
        $query = \MyProject\Model\MyProjectDataQuery::create();

        if ($this->getActive()) {
            $query->filterByIsActive(true);
        }

        return $query;
    }

    public function parseResults(LoopResult $loopResult): LoopResult
    {
        foreach ($loopResult->getResultDataCollection() as $item) {
            $row = new LoopResultRow($item);
            $row
                ->set('ID', $item->getId())
                ->set('NAME', $item->getCustomField());
            $loopResult->addRow($row);
        }

        return $loopResult;
    }
}
```

## Templates

### templates/frontOffice/

Twig templates for front-office:

```
templates/frontOffice/
└── default/
    ├── my-page.html.twig
    └── live-component/
        └── my-component.html.twig
```

### templates/backOffice/

Smarty templates for back-office:

```
templates/backOffice/
└── default/
    ├── module-config.html
    └── includes/
        └── my-partial.html
```

## Translations

### I18n/

Translation files by locale:

**I18n/en_US.php**:
```php
<?php

return [
    'My Module' => 'My Module',
    'Configuration saved successfully' => 'Configuration saved successfully',
];
```

**I18n/fr_FR.php**:
```php
<?php

return [
    'My Module' => 'Mon Module',
    'Configuration saved successfully' => 'Configuration enregistrée avec succès',
];
```

Use translations in code:

```php
// In services/controllers
$this->translator->trans('My Module', [], 'myproject');

// In Twig templates
{{ 'My Module'|trans({}, 'myproject') }}

// In Smarty templates
{intl l="My Module" d="myproject"}
```
