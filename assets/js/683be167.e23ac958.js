"use strict";(globalThis.webpackChunkthelia=globalThis.webpackChunkthelia||[]).push([[853],{8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>s});var o=r(6540);const i={},l=o.createContext(i);function t(e){const n=o.useContext(l);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),o.createElement(l.Provider,{value:n},e.children)}},9878:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>m,frontMatter:()=>t,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"forms","title":"Forms","description":"Form definitions","source":"@site/docs/forms.md","sourceDirName":".","slug":"/forms","permalink":"/docs/docs/forms","draft":false,"unlisted":false,"editUrl":"https://github.com/thelia/docs/edit/main/docs/forms.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"title":"Forms","sidebar_position":10},"sidebar":"myAutogeneratedSidebar","previous":{"title":"Events","permalink":"/docs/docs/events"},"next":{"title":"Commands","permalink":"/docs/docs/commands/"}}');var i=r(4848),l=r(8453);const t={title:"Forms",sidebar_position:10},s=void 0,a={},d=[{value:"Form definitions",id:"form-definitions",level:2},{value:"Usage in templates",id:"usage-in-templates",level:2},{value:"Call your form",id:"call-your-form",level:3},{value:"Display it",id:"display-it",level:3},{value:"Displaying a form field",id:"displaying-a-form-field",level:3},{value:"Custom form field",id:"custom-form-field",level:4},{value:"Auto form field",id:"auto-form-field",level:4},{value:"Display errors",id:"display-errors",level:3},{value:"Hidden fields",id:"hidden-fields",level:3},{value:"Usage in controllers",id:"usage-in-controllers",level:2}];function c(e){const n={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"form-definitions",children:"Form definitions"}),"\n",(0,i.jsxs)(n.p,{children:["To create a new form create a new class that extend ",(0,i.jsx)(n.code,{children:"BaseForm"})," then implement the method ",(0,i.jsx)(n.code,{children:"buildForm"})," to describe your form."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"<?php\nnamespace Thelia\\Form;\n\nuse Symfony\\Component\\Form\\Extension\\Core\\Type\\IntegerType;\nuse Symfony\\Component\\Validator\\Constraints;\nuse Symfony\\Component\\Validator\\Context\\ExecutionContextInterface;\nuse Thelia\\Core\\Translation\\Translator;\nuse Thelia\\Model\\AddressQuery;\nuse Thelia\\Model\\ModuleQuery;\nuse Thelia\\Module\\BaseModule;\n\nclass OrderDeliveryForm extends BaseForm\n{\n    protected function buildForm(): void\n    {\n        $this->formBuilder\n            ->add('delivery-address', IntegerType::class, [\n                'required' => true,\n                'constraints' => [\n                    new Constraints\\NotBlank(),\n                    new Constraints\\Callback(\n                        [$this, 'verifyDeliveryAddress']\n                    ),\n                ],\n            ])\n            ->add('delivery-module', IntegerType::class, [\n                'required' => true,\n                'constraints' => [\n                    new Constraints\\NotBlank(),\n                    new Constraints\\Callback(\n                        [$this, 'verifyDeliveryModule']\n                    ),\n                ],\n            ]);\n    }\n\n    public function verifyDeliveryAddress($value, ExecutionContextInterface $context): void\n    {\n        $address = AddressQuery::create()\n            ->findPk($value);\n\n        if (null === $address) {\n            $context->addViolation(Translator::getInstance()->trans('Address ID not found'));\n        }\n    }\n\n    public function verifyDeliveryModule($value, ExecutionContextInterface $context): void\n    {\n        $module = ModuleQuery::create()\n            ->filterActivatedByTypeAndId(BaseModule::DELIVERY_MODULE_TYPE, $value)\n            ->findOne();\n\n        if (null === $module) {\n            $context->addViolation(Translator::getInstance()->trans('Delivery module ID not found'));\n        } elseif (!$module->isDeliveryModule()) {\n            $context->addViolation(\n                sprintf(Translator::getInstance()->trans(\"delivery module %s is not a Thelia\\Module\\DeliveryModuleInterface\"), $module->getCode())\n            );\n        }\n    }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["For more information about field types you can refer to ",(0,i.jsx)(n.a,{href:"https://symfony.com/doc/current/reference/forms/types.html",children:"Symfony form type documentation"})]}),"\n",(0,i.jsx)(n.h2,{id:"usage-in-templates",children:"Usage in templates"}),"\n",(0,i.jsxs)(n.p,{children:["To display the form in your template you will need the form name, it is the name of your module in lowercase + full namespace and the class of your form in snake_case.\nFor example the form name for ",(0,i.jsx)(n.code,{children:"YourModule\\Form\\SomethingForm.php"})," will be ",(0,i.jsx)(n.code,{children:"yourmodule_form_something_form"}),"\nIt can be modified with the static function ",(0,i.jsx)(n.code,{children:"getName"})," but we do not advise to do that,\nbecause it's more simple to guess a form name by reading is namespace than going in to the class and looking the method.\nIt also guarantees a unique name for your form."]}),"\n",(0,i.jsx)(n.h3,{id:"call-your-form",children:"Call your form"}),"\n",(0,i.jsx)(n.p,{children:"First of all you have to call the form you need by using the form block :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-smarty",children:'    {form name="yourmodule_form_something_form"}\n        ...\n    {/form}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The form reference is now available in the ",(0,i.jsx)(n.code,{children:"$form"})," variable."]}),"\n",(0,i.jsx)(n.h3,{id:"display-it",children:"Display it"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-smarty",children:'    {form name="yourmodule_form_something_form"}\n        <form method="post" action="{url path=\'your/target\'}" {form_enctype form=$form}>\n        ...\n        </form>\n    {/form}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"displaying-a-form-field",children:"Displaying a form field"}),"\n",(0,i.jsx)(n.h4,{id:"custom-form-field",children:"Custom form field"}),"\n",(0,i.jsxs)(n.p,{children:["For displaying a field, you have to use the ",(0,i.jsx)(n.code,{children:"{form_field}"})," block, and put the name of the field you want to display in the \u201cfield\u201d parameter :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-smarty",children:'{form name="thelia_form_order_delivery_form"}\n    <form method="post" action="{url path=\'your/target\'}" {form_enctype form=$form} >\n        {form_hidden_fields form=$form}\n\n        {form_field form=$form field="firstname"}\n           <label>{intl l="{$label}"}</label>\n           <input type="text" name="{$name}" value="{$value}" {$attr} />\n        {/form_field}\n\n        {form_field form=$form field="delivery_options"}\n            <select name="{$name}">\n                {foreach $choices as $choice}\n                    <option value="{$choice->value}">{$choice->label}</option> \n                {/foreach}\n            </select>\n        {/form_field}\n    </form>\n{/form}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Values available in the ",(0,i.jsx)(n.code,{children:"{form_field}"})," block :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$name"})," : field\u2019s name used in the name part of your input"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$value"})," : default value to display"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$data"})," : the form definition data attribute"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$type"})," : the field type, as defined in the form definition (choice, radio, number, text, textarea, etc.)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$checked"})," : the checked status (true / false) of a radio or checkbox field"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$multiple"})," : true if a select field may have multiple selected values"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$disabled"})," : true if the field is disabled, false otherwise"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$read_only"})," : true if the fiedl is read only, false otherwise"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$max_length"})," : the maximum length of the field"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$required"})," : true if the field is required, false otherwise"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$label"})," : label for this field, can be used in label html tag for example"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$attr"})," : all the attributes defined in your form class, can be any HTML attributes, such as an id, or any other attribute such as HTML5 form validation for example"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$attr_list"})," : the \u2018attr\u2019 array of form definition"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$options"})," : all the options available for this field. This variable is a PHP array."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$error"})," : true if validation error has been detected on the field"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$message"})," : the error message, defined if $error is true, empty otherwise."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"$choices"})," : an array of available choices. $choices is available only if your field has defined choices."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"auto-form-field",children:"Auto form field"}),"\n",(0,i.jsxs)(n.p,{children:["To speed up writing form in templates Thelia provide a Smarty plugin ",(0,i.jsx)(n.code,{children:"render_form_field"})," which automatically generates the field HTML code, and all the related code, such as formatting and error reporting."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-smarty",children:'{form name="thelia_form_order_delivery_form"}\n    <form method="post" action="{url path=\'your/target\'}" {form_enctype form=$form} >\n        {form_hidden_fields form=$form}\n\n        {render_form_field form=$form field="firstname"}\n        {render_form_field form=$form field="delivery_options"}\n    </form>\n{/form}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"display-errors",children:"Display errors"}),"\n",(0,i.jsxs)(n.p,{children:["If your form contains some errors, it automatically displays the value already sent by the user and then can display a message for each fields containing errors. The ",(0,i.jsx)(n.code,{children:"{form_field_error}"})," is used, and it works like the ",(0,i.jsx)(n.code,{children:"{form_field}"})," block. You can call it outside the ",(0,i.jsx)(n.code,{children:"{form_field}"})," block :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-smarty",children:'{form name="thelia_form_order_delivery_form"}\n    <form method="post" action="{url path=\'your/target\'}" {form_enctype form=$form} >\n        {form_hidden_fields form=$form}\n\n        {form_field form=$form field="firstname"}\n            {form_error form=$form.firstname}\n                {$message}\n            {/form_error}\n\n            <label>{intl l="{$label}"}</label>\n           <input type="text" name="{$name}" value="{$value}" {$attr} />\n        {/form_field}\n    </form>\n{/form}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"hidden-fields",children:"Hidden fields"}),"\n",(0,i.jsxs)(n.p,{children:["Thelia uses hidden fields internally. In order to display these fields (and all the hidden fields defined in your form), use the ",(0,i.jsx)(n.code,{children:"form_hidden_fields"})," plugin.",(0,i.jsx)(n.br,{}),"\n","Don\u2019t forget this, as it contains the CRSF validation data :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-smarty",children:'{form name="thelia_form_order_delivery_form"}\n    <form method="post" action="{url path=\'your/target\'}" {form_enctype form=$form} >\n         {form_hidden_fields form=$form}\n            ...\n    </form>\n{/form}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"usage-in-controllers",children:"Usage in controllers"}),"\n",(0,i.jsx)(n.p,{children:"Form are useful to validate data submitted by users. This is done by two functions in controllers :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"createForm"})," that create a form object"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"validateForm"})," that validate form data"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace Front\\Controller;\n\nclass OrderController extends BaseFrontController\n{\n    public function submitRoute()\n    {\n        $form = $this->createForm(OrderDeliveryForm::getName);\n        \n       try {\n            $data = $this->validateForm($form)->getData();\n\n            // Do what you want with submitted data\n\n        } catch (\\Exception $e) {\n           // Do something when the form is not valid\n        }\n    }\n}\n"})})]})}function m(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);